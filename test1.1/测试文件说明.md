# AES-SM3完整性校验算法 - 测试文件说明

## 测试文件清单

根据整合文档要求，已为该项目创建以下测试文件：

### 1. 核心测试文件

#### `test_aes_sm3_integrity.c`
**主测试程序**，包含15个综合测试用例：

**功能正确性测试（6项）**
1. 基本功能测试 - 256位输出
2. 基本功能测试 - 128位输出  
3. 确定性测试 - 相同输入产生相同输出
4. 不同版本算法输出一致性（v2.2, v3.0, v3.1, v4.0, v5.0, v6.0）
5. 边界条件 - 全0输入
6. 边界条件 - 全1输入

**安全性测试（3项）**
7. 雪崩效应测试 - 单比特变化影响
8. 多点雪崩效应测试
9. 输出分布均匀性测试

**性能基准测试（4项）**
10. 单块处理性能基准（目标：35,000-55,000 MB/s）
11. 不同版本性能对比
12. vs SHA256/SM3基准性能对比
13. 批处理性能测试

**内存优化测试（1项）**
14. 内存访问优化效果测试（调用主文件函数）

**压力测试（2项）**
15. 长时间稳定性测试（30秒连续运行）
16. 随机输入压力测试（10000组）

### 2. 编译和运行脚本

#### `run_tests.sh` (Linux/Unix)
**Linux/Unix平台自动化测试脚本**

功能：
- 自动检测CPU架构和特性（NEON、Crypto扩展）
- 智能选择编译选项
- 编译测试程序
- 运行完整测试或快速测试
- 彩色输出测试结果

用法：
```bash
chmod +x run_tests.sh        # 添加执行权限（仅首次需要）
./run_tests.sh               # 运行完整测试
./run_tests.sh quick         # 快速测试（2分钟超时）
```

#### `run_tests.bat` (Windows)
**Windows平台自动化测试脚本**

功能：
- 检测GCC编译器
- 编译测试程序
- 运行测试
- 显示测试结果

用法：
```batch
run_tests.bat                # 运行完整测试
run_tests.bat quick          # 快速测试
```

### 3. Makefile

#### `Makefile.test`
**GNU Make构建文件**

功能：
- 智能检测CPU架构并选择优化选项
- 提供多种测试目标
- 彩色输出和友好提示

用法：
```bash
make -f Makefile.test              # 编译测试程序
make -f Makefile.test test         # 编译并运行完整测试
make -f Makefile.test quick        # 快速测试（2分钟超时）
make -f Makefile.test perf         # 只运行性能测试
make -f Makefile.test security     # 只运行安全性测试
make -f Makefile.test check        # 检查编译环境
make -f Makefile.test clean        # 清理编译产物
make -f Makefile.test help         # 显示帮助
```

### 4. 文档

#### `TEST_README.md`
**详细测试文档**

内容：
- 测试覆盖范围详解
- 编译和运行指南
- 测试结果解读
- 测试环境要求
- 故障排除指南
- 性能优化建议
- 常见问题FAQ

## 测试覆盖的整合文档要求

### 1. 功能正确性验证 ✓
- [x] XOR折叠压缩正确性
- [x] SM3哈希输出正确性
- [x] 不同版本输出一致性测试
- [x] 128位和256位输出正确性
- [x] 边界条件测试

### 2. 性能目标验证 ✓
- [x] 单块处理吞吐量：35,000-55,000 MB/s（v5.0/v6.0）
- [x] vs SHA256硬件加速：15-20倍
- [x] vs 纯SM3：50-60倍
- [x] 批处理性能测试
- [x] 不同版本性能对比

### 3. 安全性验证 ✓
- [x] 雪崩效应测试（单比特变化影响35-65%）
- [x] 输出分布均匀性（>85%比特位均衡）
- [x] 确定性测试

### 4. 内存访问优化验证 ✓
- [x] 预取优化效果（10-20%提升）
- [x] 内存对齐优化效果（5-10%提升）
- [x] 总体优化效果（15-30%提升）

### 5. 稳定性验证 ✓
- [x] 长时间稳定性测试
- [x] 随机输入压力测试
- [x] 批处理边界条件测试

## 快速开始

### Linux/Unix平台（推荐）

```bash
# 方法1：使用脚本（最简单）
./run_tests.sh

# 方法2：使用Makefile
make -f Makefile.test test

# 方法3：手动编译
gcc -march=armv8.2-a+crypto -O3 -funroll-loops -ftree-vectorize \
    -finline-functions -ffast-math -flto -fomit-frame-pointer -pthread \
    -o test_aes_sm3 aes_sm3_integrity.c test_aes_sm3_integrity.c -lm
./test_aes_sm3
```

### Windows平台

```batch
REM 使用批处理脚本
run_tests.bat

REM 或手动编译
gcc -O3 -funroll-loops -ftree-vectorize -finline-functions -pthread ^
    -o test_aes_sm3.exe aes_sm3_integrity.c test_aes_sm3_integrity.c -lm
test_aes_sm3.exe
```

## 测试输出示例

成功的测试输出应包含：

```
╔══════════════════════════════════════════════════════════╗
║       AES-SM3完整性校验算法 - 综合测试套件               ║
║       Comprehensive Test Suite for AES-SM3 Integrity    ║
╚══════════════════════════════════════════════════════════╝

═══════════════════════════════════════════════════════════
第一部分：功能正确性测试
═══════════════════════════════════════════════════════════

▶ 测试: 基本功能测试 - 256位输出
  256位输出: a1b2c3d4...
✓ 通过 (耗时: 0.000123秒)

...（其他测试）...

═══════════════════════════════════════════════════════════
第三部分：性能基准测试
═══════════════════════════════════════════════════════════

▶ 测试: 单块处理性能基准测试（目标：35,000-55,000 MB/s）
  迭代次数: 100000
  总耗时: 8.890000秒
  吞吐量: 45000.50 MB/s
  单块延迟: 88.90微秒
  ✓ 达到性能目标（>= 35,000 MB/s）
✓ 通过 (耗时: 8.890000秒)

...（其他测试）...

╔══════════════════════════════════════════════════════════╗
║                   测试结果汇总                            ║
╚══════════════════════════════════════════════════════════╝

  总测试数:   15
  通过:       15
  失败:       0
  总耗时:     45.23秒

  ✓ 所有测试通过！
```

## 性能基准值参考

根据整合文档，在ARMv8.2平台上的预期性能：

| 版本 | 吞吐量 (MB/s) | vs SHA256硬件 | vs SM3 |
|-----|--------------|-------------|--------|
| v2.2 标准版 | 20,000+ | 8x | 25x |
| v3.0 Extreme | 25,000-40,000 | 14x | 44x |
| v3.1 Ultra | 28,000-42,000 | 15x | 47x |
| v4.0 Mega | 30,000-45,000 | 17x | 52x |
| v5.0 Super ★ | 35,000-50,000 | 18x | 56x |
| v6.0 Hyper 🏆 | 40,000-55,000 | 20x | 62x |

**SHA256硬件加速**: 2,500-3,500 MB/s  
**纯SM3**: 800-1,000 MB/s

## 注意事项

1. **平台要求**：测试需要在ARMv8.2-A平台上运行才能获得最佳性能
2. **编译优化**：必须使用 `-O3` 和 `-march=armv8.2-a+crypto` 选项
3. **CPU频率**：建议设置CPU为性能模式以获得稳定的测试结果
4. **系统负载**：测试期间应尽量减少其他程序运行
5. **Windows平台**：Windows版本不支持ARM硬件加速，性能会显著降低

## 故障排除

**问题1**：编译失败 `unknown option '-march=armv8.2-a+crypto'`
- **解决**：使用备选编译选项 `-march=armv8-a+crypto`

**问题2**：性能远低于预期
- **检查**：确认CPU架构、启用优化选项、CPU频率设置

**问题3**：测试超时
- **解决**：使用快速测试模式或降低迭代次数

详细故障排除请参考 `TEST_README.md`。

## 测试报告模板

完成测试后建议记录：

```
测试环境：
- CPU: [型号和频率]
- 内存: [大小]
- 操作系统: [版本]
- GCC版本: [版本号]

性能测试结果：
- v5.0 Super吞吐量: [XX,XXX MB/s]
- vs SHA256加速比: [XX.XXx]
- vs SM3加速比: [XX.XXx]

功能测试结果：
- 通过测试: [XX/15]
- 雪崩效应: [XX.X%]
- 输出分布均匀性: [XX.X%]

优化效果：
- 预取优化: [+XX.X%]
- 内存对齐优化: [+XX.X%]
```

## 文件关系图

```
项目根目录/
├── aes_sm3_integrity.c          # 主算法实现文件
├── test_aes_sm3_integrity.c     # 测试程序（本测试套件）
├── run_tests.sh                 # Linux测试脚本
├── run_tests.bat                # Windows测试脚本
├── Makefile.test                # Make构建文件
├── TEST_README.md               # 详细测试文档
└── 测试文件说明.md              # 本文件
```

## 联系和支持

如有问题或建议，请查阅 `TEST_README.md` 获取更多信息。

